<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.kh.moving.reservation.model.mapper.ReservationMapper">

  
   <!-- userId로 userNo 조회 -->
    <select id="selectUserNoByUserId" parameterType="string" resultType="int">
        SELECT USER_NO
        FROM TB_MEMBER
        WHERE USER_ID = #{userId}
    </select>
    
    <!-- TB_RESERVATION INSERT -->
    <insert id="insertReservation" parameterType="ReservationDTO">
        <!-- BEFORE로 시퀀스 먼저 가져오기 -->
        <selectKey keyProperty="reservationId" resultType="int" order="BEFORE">
            SELECT RESERVATION_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        
        INSERT INTO TB_RESERVATION (
            RESERVATION_ID,
            USER_NO,
            MOVIE_ID,
            SCREENING_ID,
            RESERVATION_STATUS,
            RESERVATION_DATE
        ) VALUES (
            #{reservationId},
            #{userNo},
            #{movieId},
            #{screeningId},
            'Y',
            SYSDATE
        )
    </insert>
    
    <!-- TB_RESERVATION_SEAT INSERT -->
    <insert id="insertReservationSeat">
        INSERT INTO TB_RESERVATION_SEAT (
            SEAT_ID,
            SEAT_NUMBER,
            RESERVATION_ID
        ) VALUES (
            RESERVATION_SEAT_SEQ.NEXTVAL,
            #{seat},
            #{reservationId}
        )
    </insert>
    
</mapper>